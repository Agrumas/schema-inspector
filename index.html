<!DOCTYPE html>
<html>
	<head>
	<meta charset='utf-8'>
	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	<meta name="viewport" content="width=640" />

	<link rel="stylesheet" href="stylesheets/core.css" media="screen"/>
	<link rel="stylesheet" href="stylesheets/mobile.css" media="handheld, only screen and (max-device-width:640px)"/>
	<link rel="stylesheet" href="stylesheets/pygment_trac.css"/>
	<link rel="stylesheet" href="http://codemirror.net/lib/codemirror.css"/>
	<link rel="stylesheet" href="http://codemirror.net/theme/solarized.css"/>

	<script type="text/javascript" src="javascripts/modernizr.js"></script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script type="text/javascript" src="http://codemirror.net/lib/codemirror.js"></script>
	<script type="text/javascript" src="http://codemirror.net/mode/javascript/javascript.js"></script>
	<script type="text/javascript" src="http://codemirror.net/addon/runmode/runmode.js"></script>
	<script type="text/javascript" src="https://rawgithub.com/caolan/async/master/lib/async.js"></script>
	<script type="text/javascript" src="https://rawgithub.com/atinux/schema-inspector/master/lib/schema-inspector.js"></script>
	<title>Schema-Inspector - A powerful tool to validate and sanitize JS objects</title>
	<meta name="description" content="Schema-Inspector is a powerful tool to sanitize and validate JS objects. It's designed to work both client-side and server-side and to be scalable with allowing asynchronous and synchronous calls." />
	</head>
<body>
	<a id="forkme_banner" href="https://github.com/Atinux/schema-inspector">View on GitHub</a>
	<div class="shell">
		<header>
		<span class="ribbon-outer">
			<span class="ribbon-inner">
			<h1>Schema-inspector</h1>
			<h2>A powerful tool to sanitize and validate JS objects.</h2>
			</span>
			<span class="left-tail"></span>
			<span class="right-tail"></span>
		</span>
		</header>
		<section id="downloads">
		<span class="inner">
			<a href="https://github.com/Atinux/schema-inspector/zipball/master" class="zip"><em>download</em> .ZIP</a><a href="https://github.com/Atinux/schema-inspector/tarball/master" class="tgz"><em>download</em> .TGZ</a>
		</span>
		</section>
		<span class="banner-fix"></span>
		<section id="main_content">
			<h1><a name="schema-inspector" class="anchor" href="#schema-inspector"><span class="octicon octicon-link"></span></a>Schema-Inspector</h1>
			<p>Schema-Inspector is a powerful tool to sanitize and validate JS objects. It's designed to work both client-side and server-side and to be scalable with allowing asynchronous and synchronous calls.</p>
			<h2>Try it by yourself</h2>
			<p>Update the data, sanitization and validation tabs to see in real-time the result of the Schema-inspector.</p>
		</section>
	</div>
	<div class="play-it">
		<div class="step step-1">
			<h3 class="title">Data</h3>
<textarea>{
	// You can edit the data here
	name: "  sebastien chopin ",
	age: "22",
	compagnies: "malea, pantera",
	birthday: 722517795000
}





















</textarea>
		</div>
	<!-- <div class="plus-sign">+</div> -->
		<div class="step step-2">
			<h3 class="title"><label><input type="checkbox" id="checkSanitization" name="sanitization" checked="checked"/> Sanitization</label> - <a href="https://github.com/Atinux/schema-inspector#sanitization" target="_blank" class="doc">See the sanitization doc</a></h3>
<textarea>{
	// You can edit the sanitization too
	type: "object",
	properties: {
		name: {
			type: "string",
			rules: ["trim", "title"],
		},
		age: {
			type: "integer"
		},
		compagnies: {
			type: "array", // split with "," by default
			items: {
				type: "string",
				rules: ["trim", "ucfirst"]
			}
		},
		gender: {
			type: "string",
			optional: false,
			def: "m" // if not given, will be "m"
		},
		birthday: {
			type: "date" // transform timestamp to date
		}
	}
}
</textarea>
		</div>
		<div class="step step-3">
			<h3 class="title"><label><input type="checkbox" id="checkValidation" name="validation" checked="checked"/> Validation</label> - <a href="https://github.com/Atinux/schema-inspector#validation" target="_blank" class="doc">See the validation doc</a></h3>
<textarea>{
	// And the validation!
	type: "object",
	properties: {
		name: {
			type: "string",
			minLength: 1
		},
		age: {
			type: "integer",
			gt: 0,
			lte: 120
		},
		gender: {
			type: "string",
			eq: ["m", "f"]
		},
		compagnies: {
			type: "array",
			items: {
				type: "string",
				minLength: 1
			}
		},
		birthday: {
			type: "date"
		}
	}
}</textarea>
		</div>
		<div class="step step-4">
			<h3 class="title">Result:</h3>
			<div class="result"></div>
		</div>
	</div>
<script type="text/javascript">
function getObject(editor, callback) {
	try {
		var data = JSON.parse(editor.getValue() || '{}');
		callback(null, data);
	} catch (e) {
		try {
			var s = String(editor.getValue() || '{}').replace(/([^(http:|https:|ftp:)])\/\/[^\n\r]*(?:[\n\r]+|$)/gi, '$1').replace(/\n/g, '').trim();
			s = (s[0] !== '{' && s[0] !== '[' ? '{' : s[0]) + s.slice(1, s.length - 1) + (s[s.length - 1] !== '}' && s[s.length - 1] !== ']' ? '}' : s[s.length - 1]);
			// console.log(s);
			eval('var variable = ' + s +';');
			callback(null, variable);
		} catch (e) {
			callback((e && e.message ? e.message : e));
		}
	}
}

function checkSchemaInspector() {
	$('.result').html('<button class="btn run">Refresh result</button>');
	async.parallel({
		data: function (next) {
			getObject(editorData, next);
		},
		sanitization: function (next) {
			if (!sanitization)
			return next(null, null);
			getObject(editorSanitization, next);
		},
		validation: function (next) {
			if (!validation)
			return next(null, null);
			getObject(editorValidation, next);
		}
		}, function (err, res) {
		if (err)
			return $('.result').append('<div class="error">'+err+'</div>');
		if (sanitization) {
			var sanitizationResult = SchemaInspector.sanitize(res.sanitization, res.data);
			// console.log(sanitizationResult.format());
		}
		if (validation) {
			var validationResult = SchemaInspector.validate(res.validation, res.data);
			console.log(validationResult, res.validation, res.data);
			if (!validationResult.valid) {
			$('.result').append('<h2 class="validation-title">Validation error:</h2>');
			return $('.result').append('<div class="validation-error">'+validationResult.format().replace(/\n/g, '<br>')+'</div>');
			}
		}
		$('.result').append('<pre class="data cm-s-default"></pre>');
		CodeMirror.runMode(JSON.stringify(res.data, null, 4), { name: "javascript", json: true }, $('.result .data')[0]);
	});
}

$(function () {

	CodeMirror.defaults.mode = { name: "javascript", json: true };
	CodeMirror.defaults.theme = "solarized dark";
	CodeMirror.defaults.indentUnit = 2;
	CodeMirror.defaults.tabSize = 2;
	CodeMirror.defaults.indentWithTabs = true;
	CodeMirror.defaults.viewportMargin = Infinity;
	window.editorData = CodeMirror.fromTextArea($('.step-1 textarea')[0], { autofocus: true });
	window.editorSanitization = CodeMirror.fromTextArea($('.step-2 textarea')[0]);
	window.editorValidation = CodeMirror.fromTextArea($('.step-3 textarea')[0]);

	editorData.on('change', checkSchemaInspector);
	editorSanitization.on('change', checkSchemaInspector);
	editorValidation.on('change', checkSchemaInspector);
	$('body').on('click', '.btn.run', checkSchemaInspector);

	window.sanitization = $('#checkSanitization').is(':checked');
	$('#checkSanitization').change(function () {
		window.sanitization = $(this).is(':checked');
		if (!sanitization) {
			$('.step-2 .CodeMirror').hide();
		} else {
			$('.step-2 .CodeMirror').show();
		}
		checkSchemaInspector();
	});
	window.validation = $('#checkValidation').is(':checked');
	$('#checkValidation').change(function () {
		window.validation = $(this).is(':checked');
		if (!validation) {
			$('.step-3 .CodeMirror').hide();
		} else {
			$('.step-3 .CodeMirror').show();
		}
		checkSchemaInspector();
	});
	checkSchemaInspector();

});
</script>
	</body>
</html>
